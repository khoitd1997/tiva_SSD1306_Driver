#include <assert.h>
#include <stdbool.h>
#include <stdint.h>
#include <stdio.h>
#include <string.h>

#include "inc/hw_i2c.h"

#include "inc/hw_ints.h"

#include "inc/hw_memmap.h"

#include "inc/hw_types.h"

#include "driverlib/gpio.h"

#include "driverlib/i2c.h"

#include "driverlib/interrupt.h"

#include "driverlib/pin_map.h"

#include "driverlib/sysctl.h"

#include "driverlib/uart.h"

#include "utils/uartstdio.h"

#include "tiva_utils/bit_manipulation.h"

#include "ssd1306.h"

#include "oled_font.h"

// static uint8_t rawFont[4][128] = {
//     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0xe0, 0xe0, 0xe0,
//     0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0,
//     0xe0, 0xe0, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x1c, 0x3c,
//     0x1c, 0x1c, 0x3c, 0x3c, 0x3c, 0x3c, 0x7c, 0x7c, 0xfc, 0xfe, 0xfe, 0xfe,
//     0xfe, 0xfe, 0xfe, 0xfe, 0xfe, 0xfe, 0xfe, 0xfe, 0xfe, 0xfe, 0xfe, 0xfe,
//     0xfe, 0xfe, 0xfe, 0xfe, 0xfe, 0xfe, 0xfe, 0xff, 0xff, 0xff, 0xff, 0xff,
//     0xff, 0xfe, 0xfe, 0xfe, 0xfe, 0xfe, 0xfe, 0xfc, 0xfc, 0xfc, 0xfc, 0xfc,
//     0xfc, 0xfc, 0xf8, 0xf8, 0xf8, 0xf8, 0xf0, 0xf0, 0xf0, 0xf0, 0xe0, 0xe0,
//     0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xf0, 0xe0, 0xc0, 0xc0,
//     0xc0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//     0x00, 0x00, 0x00, 0x00, 0x1f, 0x1f, 0x0f, 0x0f, 0x0f, 0x4f, 0x4f, 0x4f,
//     0x4f, 0xcf, 0x47, 0x4f, 0x4f, 0xcf, 0xcf, 0xdf, 0xdf, 0xff, 0xff, 0xfd,
//     0xfd, 0xff, 0xf8, 0xf8, 0x20, 0x00, 0xf8, 0xfd, 0xfe, 0xf4, 0x00, 0xfc,
//     0xfc, 0xf8, 0xe0, 0xf0, 0xf8, 0xf0, 0x00, 0xf0, 0xf0, 0x40, 0xf0, 0xe0,
//     0xc0, 0xd0, 0xc0, 0xe0, 0xc0, 0xc0, 0xc1, 0xc3, 0xe3, 0xe3, 0xe3, 0xe3,
//     0xe7, 0xff, 0xef, 0xcf, 0xc7, 0xcf, 0xcf, 0xcf, 0xcf, 0xcf, 0xcf, 0xcf,
//     0xcf, 0xcf, 0xcf, 0xcf, 0xcf, 0xcf, 0x4f, 0x4f, 0x4f, 0x0f, 0x0f, 0x0f,
//     0x0f, 0x0f, 0x1f, 0x17, 0x17, 0x17, 0x17, 0x37, 0x37, 0x37, 0x33, 0x33,
//     0x3b, 0x3b, 0x39, 0x39, 0x39, 0x38, 0x38, 0x38, 0x30, 0x30, 0x30, 0x11,
//     0x31, 0x11, 0x11, 0x19, 0x19, 0x1d, 0x1c, 0x14, 0x10, 0x10, 0x10, 0x10,
//     0x00, 0x08, 0x08, 0x08, 0x00, 0x00, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08,
//     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0x08, 0x08, 0x08, 0x08,
//     0x08, 0x18, 0x3c, 0x1c, 0x1c, 0x3c, 0x3c, 0x7c, 0x7c, 0x3c, 0xbc, 0xbc,
//     0x7c, 0x3c, 0x7c, 0x7c, 0x3c, 0x7c, 0x1c, 0x5c, 0x1c, 0x3c, 0x1c, 0x1c,
//     0x3e, 0x3c, 0x7e, 0x7e, 0x3e, 0x3e, 0x3e, 0x1e, 0x1e, 0x3e, 0x7e, 0x9e,
//     0x9e, 0x7e, 0x7e, 0x7e, 0x7e, 0x3e, 0x3e, 0x3e, 0x7e, 0x7e, 0x3e, 0x3e,
//     0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x7e, 0x7e, 0x7e, 0x3f, 0x3f, 0x3f, 0x1f,
//     0x3f, 0x3f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x0f,
//     0x1f, 0x1f, 0x1f, 0x1f, 0x3f, 0x2f, 0x0f, 0x0f, 0x0f, 0x0e, 0x0f, 0x07,
//     0x07, 0x06, 0x1f, 0x06, 0x06, 0x06, 0x06, 0x02, 0x02, 0x00, 0x00, 0x00,
//     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

// static uint8_t rawFont[4][128] = {
//     // 0xff, 0xff, 0xff, 0xff, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11,
//     16, 0, 0, 0, 8,   0, 0,  0, 248, 7, 0, 0, 0, 0, 0,  0, 0, 0, 0,  0, 0, 0,
//     0,  0, 0, 0, 0,   0, 0,  0, 0,   0, 0, 0, 0, 0, 8,  4, 0, 0, 72, 4, 0, 0,
//     72, 4, 0, 0, 176, 3, 0,  0, 0,   0, 0, 0, 0, 0, 0,  0, 0, 0, 0,  0, 248,
//     7, 0,  0, 0, 0, 0,   0, 72, 4, 0,   0, 0, 0, 0, 0, 72, 4, 0, 0, 0,  0, 0,
//     0, 72, 4, 0, 0, 0,   0, 0,  0, 0,   0, 0, 0, 0, 0, 0,  0, 0, 0, 0,  0, 0,
//     0, 0,  0, 0, 0, 0,   0, 0,  0, 0,   0, 0, 0, 0, 0, 0,  0, 0, 0};

int main(void) {
  ssd1306Init();

  // Enable the GPIO Peripheral used by the UART.
  SysCtlPeripheralEnable(SYSCTL_PERIPH_GPIOA);
  while (!SysCtlPeripheralReady(SYSCTL_PERIPH_GPIOA)) {
  }

  // Enable UART0
  SysCtlPeripheralEnable(SYSCTL_PERIPH_UART0);
  while (!SysCtlPeripheralReady(SYSCTL_PERIPH_UART0)) {
  }

  // Configure GPIO Pins for UART mode.
  GPIOPinConfigure(GPIO_PA0_U0RX);
  GPIOPinConfigure(GPIO_PA1_U0TX);
  GPIOPinTypeUART(GPIO_PORTA_BASE, GPIO_PIN_0 | GPIO_PIN_1);

  // Use the internal 16MHz oscillator as the UART clock source.
  UARTClockSourceSet(UART0_BASE, UART_CLOCK_PIOSC);

  // Initialize the UART for console I/O.
  UARTStdioConfig(0, 115200, 16000000);

  UARTprintf("Starting sd1306 test\n");
  ssd1306TurnOn();

  ssd1306ClearDisplay();
  //   ssd1306Draw(0, 0, rawFont, 512);
  ssd1306PrintString("A B C D E");
  for (;;) {
    ssd1306AdjustContrast(0);
    UARTprintf("New contrast 1\n");
    for (uint32_t waitIndex = 0; waitIndex < 5000000; ++waitIndex) {
    }
    ssd1306AdjustContrast(250);
    UARTprintf("New contrast 2\n");
    for (uint32_t waitIndex = 0; waitIndex < 5000000; ++waitIndex) {
    }
  }
  return 0;
}
